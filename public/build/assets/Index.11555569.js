import{u as w,q as z,s as D,r as o,o as n,k as p,l as i,e as t,x as c,f as g,d as _,m as N,h as O,A as E,y as M,c as H,t as L,G as I,a as b,F as h,z as R,n as q,v as F,T as G}from"./app.537b83f5.js";const J={class:"grid grid-cols-1"},K={class:"col"},P={name:"TaskMediaForm"},Q=Object.assign(P,{props:{task:{type:Object,default(){return{}}},visibility:{type:Boolean,default:!1}},emits:["close","completed"],setup(s,{emit:l}){w();const m={media:[],mediaToken:"",mediaHash:""},f="task/media/";z(f);const d=D({...m});return(k,e)=>{const v=o("MediaUpload"),y=o("FormAction"),$=o("BaseSideover");return n(),p($,{visibility:s.visibility,onClose:e[5]||(e[5]=a=>l("close"))},{title:i(()=>[t("span",null,c(k.$trans("global.add",{attribute:k.$trans("task.media.media")})),1)]),default:i(()=>[g(y,{sideover:"","no-card":"","no-data-fetch":"","cancel-action":"",action:"create","init-url":f,"init-form":m,form:d,onEnd:e[2]||(e[2]=a=>l("close")),onCompleted:e[3]||(e[3]=a=>l("completed")),onCancelled:e[4]||(e[4]=a=>l("close"))},{default:i(()=>[t("div",J,[t("div",K,[s.task.uuid?(n(),p(v,{key:0,"media-token":s.task.mediaToken,multiple:"",label:k.$trans("general.file"),module:"task",media:d.media,onSetHash:e[0]||(e[0]=a=>d.mediaHash=a),onSetToken:e[1]||(e[1]=a=>d.mediaToken=a)},null,8,["media-token","label","media"])):_("",!0)])])]),_:1},8,["form"])]),_:1},8,["visibility"])}}}),W={class:"grid grid-cols-1"},X={class:"grid grid-cols-4 gap-6"},Y=["onClick"],Z={class:"flex justify-between items-start"},ee={class:"flex cursor-pointer"},te={class:"mr-4"},se={class:"flex flex-col"},ae={name:"TaskMediaList"},oe=Object.assign(ae,{props:{task:{type:Object,default(){return{}}}},emits:["refresh"],setup(s,{emit:l}){const m=s;w(),N();const f=O(),d=E("emitter"),k="task/media/",e=M(!1),v=M(!1),y=()=>{v.value=!1},$=H(()=>f.getters["config/config"]("system.url")),a=u=>{window.open($.value+`/app/tasks/${m.task.uuid}/media/`+u)},T=async u=>{!await G()||(e.value=!0,await f.dispatch(k+"delete",{uuid:m.task.uuid,moduleUuid:u.uuid}).then(()=>{e.value=!1,l("refresh")}).catch(C=>{e.value=!1}))};return L(async()=>{d.on("addTaskMedia",()=>{v.value=!0})}),I(()=>{d.all.delete("addTaskMedia")}),(u,C)=>{const x=o("FloatingMenuItem"),U=o("FloatingMenu"),j=o("BaseAlert"),S=o("BaseDataView"),V=o("BaseCard");return n(),b(h,null,[s.task.uuid?(n(),p(V,{key:0,"is-loading":e.value},{default:i(()=>[t("div",W,[g(S,{class:"col-span-1"},{default:i(()=>[t("div",X,[(n(!0),b(h,null,R(s.task.media,r=>{var B;return n(),b("div",{onClick:A=>a(r.uuid),class:"col-span-4 sm:col-span-1"},[t("div",Z,[t("div",ee,[t("span",te,[t("i",{class:q(["fas text-4xl",r.icon])},null,2)]),t("div",se,[t("span",null,c(r.name),1),t("span",null,c(r.size),1),t("span",null,c(r.uuid),1)])]),t("div",null,[!s.task.isCompleted&&((B=s.task.permission)==null?void 0:B.manageMedia)?(n(),p(U,{key:0},{default:i(()=>[g(x,{icon:"fas fa-trash",onClick:A=>T(r)},{default:i(()=>[F(c(u.$trans("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):_("",!0)])])],8,Y)}),256))]),s.task.media.length===0?(n(),p(j,{key:0,design:"info",size:"xs"},{default:i(()=>[F(c(u.$trans("general.errors.attachment_not_found")),1)]),_:1})):_("",!0)]),_:1})])]),_:1},8,["is-loading"])):_("",!0),g(Q,{task:s.task,visibility:v.value,onCompleted:C[0]||(C[0]=r=>l("refresh")),onClose:y},null,8,["task","visibility"])],64)}}});export{oe as default};
